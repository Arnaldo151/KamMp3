#!/bin/bash
clear
lineas="===================================="
red='\033[1;31m'
green='\033[1;32m'
yellow='\033[1;33m'
blue='\033[1;34m'
magenta='\033[1;35m'
cyan='\033[1;36m'
reset='\033[0m'

printf $red
echo $lineas
echo "â•» â•»â”â”â”“â•» â•»â•ºâ”³â”“â”â”â”“â•» â•»â”â”“â•»â•»  â”â”â”“â”â”â”“â•ºâ”³â”“"
echo "â”—â”³â”›â”ƒ â”ƒâ”ƒ â”ƒ â”ƒâ”ƒâ”ƒ â”ƒâ”ƒâ•»â”ƒâ”ƒâ”—â”«â”ƒ  â”ƒ â”ƒâ”£â”â”« â”ƒâ”ƒ"
echo " â•¹ â”—â”â”›â”—â”â”›â•ºâ”»â”›â”—â”â”›â”—â”»â”›â•¹ â•¹â”—â”â•¸â”—â”â”›â•¹ â•¹â•ºâ”»â”›"
echo $lineas

# Ensure the script is running from the correct directory
current_dir=$(pwd)
script_dir="KanMp3"

if [[ "$current_dir" != *"$script_dir"* ]]; then
    echo "Error: Please run the script from the '$script_dir' directory."
    exit 1
fi

while true; do
    printf $green
    read -p "Que descargaras :
     [1] MÃºsica 
     [2] Salir " arch
     Eliga uno :
    printf $reset

    case $arch in
        [Cc]ancion|CanciÃ³n|canciÃ³n|1)
            printf $red
            read -p "Que quieres descargar:
            [1] CanciÃ³n 
            [2] Playlist 
            [3] Volver al menÃº principal " arch
            case $arch in
            Eliga uno :
                [Cc]ancion|CanciÃ³n|canciÃ³n|1)
                    echo $lineas
                    read -p "Pega la URL de la canciÃ³n _>" Ind
                    if [ -z $Ind ];then
                        echo $lineas
                        echo "No ingresante una url _>"
                        exit
                    fi

                    # Update download_dir to the desired path
                    download_dir="/storage/emulated/0/Download/KANMP3"
                    mkdir -p "$download_dir"

                    sleep 0.5
                    echo "Iniciando descarga _>"
                    yt-dlp -o "$download_dir/%(title)s.%(ext)s" -f bestaudio --embed-thumbnail --extract-audio --audio-format mp3 --audio-quality 0 "$Ind"
                    sleep 0.5 
                    echo $lineas
                    echo "Descarga finalizada, los archivos se encuentran en: $download_dir"
                    ;;
                [Pp]laylist|2)
                    read -p "Pega la URL de la playlist _>" Play
                    if [ -z $Play ];then
                        echo "No ingresante una url _>"
                        exit
                    fi
                    echo $lineas
                    sleep 0.5
                    echo "Preparando descarga _>"
                    yt-dlp -o "$download_dir/%(playlist_index)s. %(title)s.%(ext)s" --ignore-errors --format bestaudio --extract-audio --audio-format mp3 --audio-quality 160K --yes-playlist "$Play"
                    echo $lineas
                    ;;
                [Vv]olver|[3]|*)
                    break
                    ;;
            esac

            printf $reset
            ;;
        [Ss]alir|[2]|*)
            echo $lineas
            echo "Vuelva Pronto ðŸ¤­"
            echo $lineas
            exit
            ;;
    esac
done
